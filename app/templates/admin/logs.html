{% extends "admin/base.html" %}

{% block content %}
<div class="space-y-6">
    <!-- Header -->
    <div class="bg-white rounded-3xl shadow-sm border border-gray-200 p-6">
        <div class="flex justify-between items-center">
            <h2 class="text-xl font-semibold text-gray-900">Log Aktivitas Admin</h2>
        </div>
        
        <!-- Filters -->
        <div class="mt-4 flex flex-wrap gap-4 items-center">
            <form method="GET" action="{{ url_for('admin.logs') }}" class="flex items-center space-x-2">
                <input type="text" name="admin_user" value="{{ current_admin or '' }}" placeholder="Filter by admin"
                       class="px-3 py-2 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent text-sm">
                
                <select name="limit"
                        class="px-3 py-2 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent text-sm">
                    <option value="25" {% if current_limit == 25 %}selected{% endif %}>25 entri</option>
                    <option value="50" {% if current_limit == 50 %}selected{% endif %}>50 entri</option>
                    <option value="100" {% if current_limit == 100 %}selected{% endif %}>100 entri</option>
                    <option value="250" {% if current_limit == 250 %}selected{% endif %}>250 entri</option>
                </select>
                
                <button type="submit"
                        class="px-4 py-2 bg-primary text-white rounded-xl text-sm font-medium hover:bg-blue-600">
                    Filter
                </button>
                
                <a href="{{ url_for('admin.logs') }}"
                   class="px-4 py-2 border border-gray-300 rounded-xl text-sm font-medium text-gray-700 hover:bg-gray-50">
                    Reset
                </a>
            </form>
        </div>
    </div>
    
    <!-- Logs List -->
    <div class="bg-white rounded-3xl shadow-sm border border-gray-200 p-6">
        <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-50">
                    <tr>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider rounded-tl-xl">
                            Waktu
                        </th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                            Admin
                        </th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                            Aksi
                        </th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                            Target
                        </th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                            IP Address
                        </th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider rounded-tr-xl">
                            Detail
                        </th>
                    </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200">
                    {% for log in logs %}
                    <tr class="hover:bg-gray-50">
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                            {{ log.created_at.strftime('%d/%m/%Y %H:%M:%S') }}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="px-2 py-1 bg-blue-100 rounded-lg text-xs font-medium text-blue-600">
                                {{ log.admin_user }}
                            </span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="px-2 py-1 rounded-lg text-xs font-medium 
                                {% if log.action.startswith('CREATE') %}bg-green-100 text-green-600
                                {% elif log.action.startswith('UPDATE') %}bg-yellow-100 text-yellow-600
                                {% elif log.action.startswith('DELETE') %}bg-red-100 text-red-600
                                {% else %}bg-gray-100 text-gray-600{% endif %}">
                                {{ log.action }}
                            </span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                            <div class="font-medium">{{ log.target_type }}</div>
                            {% if log.target_id %}
                            <div class="text-xs text-gray-500">{{ log.target_id }}</div>
                            {% endif %}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                            {{ log.ip_address or '-' }}
                        </td>
                        <td class="px-6 py-4 text-sm text-gray-900">
                            {% if log.details %}
                            <details class="cursor-pointer">
                                <summary class="text-primary hover:text-blue-600">Detail</summary>
                                <div class="mt-2 bg-gray-50 rounded-lg p-2">
                                    <pre class="text-xs text-gray-600 overflow-x-auto">{{ log.details | tojson(indent=2) }}</pre>
                                </div>
                            </details>
                            {% else %}
                            <span class="text-gray-400">-</span>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            
            {% if not logs %}
            <div class="text-center py-8 text-gray-500">
                <div class="text-2xl mb-2">ðŸ“Š</div>
                <div>Belum ada log aktivitas</div>
            </div>
            {% endif %}
        </div>
    </div>
    
    <!-- Statistics -->
    {% if logs %}
    <div class="bg-white rounded-3xl shadow-sm border border-gray-200 p-6">
        <h3 class="text-lg font-semibold text-gray-900 mb-4">Statistik Log</h3>
        
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
            {% set action_counts = {} %}
            {% for log in logs %}
                {% if action_counts.update({log.action: action_counts.get(log.action, 0) + 1}) %}{% endif %}
            {% endfor %}
            
            {% for action, count in action_counts.items() %}
            <div class="bg-gray-50 rounded-2xl p-4 text-center">
                <div class="text-2xl font-bold text-gray-900">{{ count }}</div>
                <div class="text-sm text-gray-600">{{ action }}</div>
            </div>
            {% endfor %}
        </div>
        
        <div class="mt-4 text-sm text-gray-500">
            Menampilkan {{ logs|length }} dari {{ current_limit }} log terbaru
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}