<div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
  <!-- Left Column: Instructions and API Key -->
  <div class="space-y-6">
    <!-- Instructions Section -->
    <div class="bg-white rounded-lg p-6 border border-indigo-200">
      <div class="flex items-center mb-4">
        <div
          class="w-8 h-8 bg-blue-500 rounded-lg flex items-center justify-center mr-3"
        >
          <svg
            class="w-5 h-5 text-white"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"
            />
          </svg>
        </div>
        <h4 class="font-medium text-gray-900">Instruksi Pengisian</h4>
        <span
          class="ml-2 bg-blue-100 text-blue-800 text-xs font-medium px-2.5 py-0.5 rounded"
          >Editable</span
        >
      </div>
      <p class="text-gray-600 mb-4">
        Instruksi yang akan ditampilkan kepada responden sebelum memulai sesi
        percakapan dengan AI
      </p>

      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2"
          >Instruksi untuk Responden</label
        >
        <textarea
          x-model="settings.instructions"
          rows="6"
          class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 resize-vertical"
          placeholder="Masukkan instruksi untuk responden sebelum memulai percakapan dengan AI..."
        ></textarea>
        <p class="text-xs text-gray-500 mt-1">
          Instruksi ini akan membantu responden memahami cara berinteraksi
          dengan AI
        </p>
      </div>
    </div>

    <!-- LLM Instructions Section -->
    <div class="bg-white rounded-lg p-6 border border-indigo-200">
      <div class="flex items-center mb-4">
        <div
          class="w-8 h-8 bg-purple-500 rounded-lg flex items-center justify-center mr-3"
        >
          <svg
            class="w-5 h-5 text-white"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M8 9l3 3-3 3m5 0h3M5 20h14a2 2 0 002-2V6a2 2 0 00-2-2H5a2 2 0 00-2 2v14a2 2 0 002 2z"
            />
          </svg>
        </div>
        <h4 class="font-medium text-gray-900">Instruksi LLM</h4>
        <span
          class="ml-2 bg-purple-100 text-purple-800 text-xs font-medium px-2.5 py-0.5 rounded"
          >Custom System Prompt</span
        >
      </div>
      
      <div class="mb-4 p-4 bg-purple-50 rounded-lg border border-purple-200">
        <p class="text-sm text-gray-700">
          <strong>Keterangan:</strong> Pada assessment pertanyaan terbuka akan dilakukan percakapan melalui LLM. 
          Anda dapat memasukkan instruksi secara umum untuk personalisasi agen percakapan. 
          Kemudian yang kemudian akan dilakukan oleh LLM, anda dapat memilih model yang anda inginkan untuk analisa.
        </p>
      </div>
      
      <p class="text-gray-600 mb-4">
        Instruksi sistem custom untuk LLM. Kosongkan untuk menggunakan prompt default Anisa.
      </p>

      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2"
          >Custom System Prompt (Opsional)</label
        >
        <textarea
          x-model="settings.llm_instructions"
          rows="8"
          class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 resize-vertical font-mono text-sm"
          placeholder="Masukkan instruksi sistem custom untuk LLM. Harus mengandung placeholder {aspects}. Contoh:&#10;&#10;Anda adalah AI assistant yang membantu analisis mental health...&#10;Aspek yang perlu dieksplorasi:&#10;{aspects}&#10;&#10;Kosongkan untuk menggunakan prompt default Anisa."
        ></textarea>
        <div class="flex items-start gap-2 mt-2">
          <div class="flex-shrink-0">
            <svg class="w-4 h-4 text-amber-500 mt-0.5" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
            </svg>
          </div>
          <p class="text-xs text-amber-600">
            <strong>Wajib:</strong> Harus mengandung placeholder <code class="bg-amber-100 px-1 rounded">{aspects}</code>. 
            Parser <code class="bg-amber-100 px-1 rounded">&lt;/end_conversation&gt;</code> akan ditambahkan otomatis.
          </p>
        </div>
        <div class="flex items-start gap-2 mt-3">
          <div class="flex-shrink-0">
            <svg class="w-4 h-4 text-indigo-500 mt-0.5" fill="currentColor" viewBox="0 0 20 20">
              <path d="M10 12a2 2 0 100-4 2 2 0 000 4z"/>
              <path fill-rule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd"/>
            </svg>
          </div>
          <button
            @click="viewSystemPrompt()"
            class="text-indigo-600 hover:text-indigo-800 font-medium text-sm underline"
          >
            Lihat System Prompt (Preview Final Prompt)
          </button>
        </div>
      </div>
    </div>

    <!-- Analysis Scale Section (PHQ Style) -->
    <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-4">
      <div class="flex items-center space-x-2 mb-4">
        <div
          class="w-8 h-8 bg-orange-500 rounded flex items-center justify-center"
        >
          <svg
            class="w-4 h-4 text-white"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2-2V7a2 2 0 012-2h2a2 2 0 002 2v2a2 2 0 002 2h2a2 2 0 012-2V7a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 00-2 2v6a2 2 0 01-2 2H9z"
            ></path>
          </svg>
        </div>
        <h2 class="text-lg font-bold text-gray-800">Skala Analisis LLM</h2>
        <div class="ml-auto flex gap-2">
          <button
            @click="testAnalysis()"
            class="bg-green-600 text-white px-3 py-1 rounded text-sm hover:bg-green-700"
          >
            ðŸ§ª Test
          </button>
        </div>
      </div>

      <div class="space-y-4">
        <!-- Scale Range -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2"
            >Jumlah Tingkat Skala:
            <span x-text="analysisScaleMax"></span> (0 -
            <span
              x-text="analysisScaleMax > 0 ? analysisScaleMax - 1 : 0"
            ></span
            >)</label
          >
          <input
            type="range"
            x-model="analysisScaleMax"
            @change="updateAnalysisScaleRange()"
            min="2"
            max="10"
            class="w-full h-2 bg-orange-200 rounded-lg appearance-none cursor-pointer slider"
          />
        </div>

        <!-- Scale Labels -->
        <div class="bg-orange-50 rounded p-3 border border-orange-200">
          <div class="text-sm font-medium text-gray-700 mb-2">Label Skala</div>
          <div class="space-y-2 max-h-48 overflow-y-auto">
            <template
              x-for="(scale, index) in settings.analysis_scale"
              :key="index"
            >
              <div class="flex items-center space-x-2">
                <div
                  class="w-8 h-8 bg-orange-500 rounded flex items-center justify-center"
                >
                  <span
                    class="text-white font-bold text-xs"
                    x-text="scale.value"
                  ></span>
                </div>
                <input
                  type="text"
                  x-model="scale.description"
                  class="flex-1 px-2 py-1 border border-orange-300 rounded focus:outline-none focus:ring-1 focus:ring-orange-500 text-sm"
                  :placeholder="'Label untuk nilai ' + scale.value"
                />
              </div>
            </template>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Right Column: API Key and Models -->
  <div class="space-y-6">
    <div class="bg-white rounded-lg p-6 border border-indigo-200">
      <div class="flex items-center mb-4">
        <div
          class="w-8 h-8 bg-red-500 rounded-lg flex items-center justify-center mr-3"
        >
          <svg
            class="w-5 h-5 text-white"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M15 7a2 2 0 012 2m4 0a6 6 0 01-7.029 5.912c-.563-.097-1.159.026-1.563.43L10.5 17.25H8.25v2.25H6v2.25H2.25v-2.818c0-.597.237-1.17.659-1.591l6.499-6.499c.404-.404.527-1 .43-1.563A6 6 0 1121 9z"
            />
          </svg>
        </div>
        <h4 class="font-medium text-gray-900">OpenAI API Key</h4>
        <span
          class="ml-2 bg-red-100 text-red-800 text-xs font-medium px-2.5 py-0.5 rounded"
          >Required</span
        >
      </div>
      <p class="text-gray-600 mb-4">
        API key untuk mengakses model OpenAI (disimpan dengan aman)
      </p>

      <div>
        <div class="flex gap-2">
          <input
            type="text"
            x-model="settings.openai_api_key"
            class="flex-1 p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 font-mono text-sm"
            :placeholder="settings.openai_api_key && settings.openai_api_key.includes('â€¢') ? 'Key is encrypted - enter new key to replace' : 'sk-proj-...'"
          />
          <button
            @click="testApiKey()"
            class="px-4 py-3 bg-red-600 text-white rounded-lg hover:bg-red-700 text-sm whitespace-nowrap"
          >
            Test API Key
          </button>
        </div>
        <p class="text-xs text-gray-500 mt-1">
          <span
            x-show="settings.openai_api_key && settings.openai_api_key.includes('â€¢')"
            class="text-green-600"
          >
            OK Encrypted API key stored securely. Enter new key to replace.
          </span>
          <span
            x-show="!settings.openai_api_key || !settings.openai_api_key.includes('â€¢')"
            class="text-gray-500"
          >
            API key will be encrypted and stored securely. Click "Test API Key"
            for validation.
          </span>
        </p>
      </div>
    </div>

    <div class="bg-white rounded-lg p-6 border border-indigo-200">
      <div class="flex items-center mb-4">
        <div
          class="w-8 h-8 bg-green-500 rounded-lg flex items-center justify-center mr-3"
        >
          <svg
            class="w-5 h-5 text-white"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"
            />
          </svg>
        </div>
        <h4 class="font-medium text-gray-900">Model OpenAI</h4>
        <span
          class="ml-2 bg-green-100 text-green-800 text-xs font-medium px-2.5 py-0.5 rounded"
          >Dual Model System</span
        >
      </div>
      <p class="text-gray-600 mb-6">
        klik refresh untuk melihat model yang tersedia Kemudian Pilih moodel
        yang tedari model yang tersedia
      </p>

      <div class="space-y-6">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2"
            >Model Chat (Percakapan)</label
          >
          <input
            type="text"
            x-model="settings.chat_model"
            class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 font-mono text-sm"
            placeholder="gpt-4o"
          />
          <p class="text-xs text-gray-500 mt-1">
            Untuk percakapan real-time dengan pengguna
          </p>
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2"
            >Model Analisis (Evaluasi)</label
          >
          <input
            type="text"
            x-model="settings.analysis_model"
            class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 font-mono text-sm"
            placeholder="gpt-4o-mini"
          />
          <p class="text-xs text-gray-500 mt-1">
            Untuk analisis mendalam hasil percakapan
          </p>
        </div>
      </div>

      <div class="mt-4 flex justify-start gap-3">
        <button
          @click="refreshModels()"
          class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 text-sm"
        >
          Muat ulang Model
        </button>
        <button
          @click="testModel(settings.chat_model, 'Chat'); testModel(settings.analysis_model, 'Analysis')"
          class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 text-sm"
        >
          Cek Ketersediaan Model
        </button>
      </div>

      <div class="mt-4 p-4 bg-gray-50 rounded-lg">
        <div class="text-center">
          <p class="text-sm text-gray-600 mb-3">Current Models</p>
          <div class="grid grid-cols-2 gap-4 text-sm">
            <div class="text-center">
              <span class="block text-gray-500 text-xs">Chat Model</span>
              <code
                class="font-mono text-gray-900"
                x-text="settings.chat_model || 'gpt-4o'"
              ></code>
            </div>
            <div class="text-center">
              <span class="block text-gray-500 text-xs">Analysis Model</span>
              <code
                class="font-mono text-gray-900"
                x-text="settings.analysis_model || 'gpt-4o-mini'"
              ></code>
            </div>
          </div>
        </div>
      </div>

      <div
        class="mt-6 p-4 bg-gray-50 rounded-lg"
        x-show="availableModels.length > 0"
      >
        <h5 class="text-sm font-medium text-gray-700 mb-3">
          Available Models (click to copy)
        </h5>
        <div
          class="grid grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-2 max-h-48 overflow-y-auto"
        >
          <template x-for="model in availableModels" :key="model">
            <div class="bg-white p-2 rounded border text-xs">
              <code class="block font-mono text-gray-800" x-text="model"></code>
              <div class="flex gap-1 mt-2">
                <button
                  @click="copyModelToChat(model)"
                  class="px-2 py-1 bg-blue-100 text-blue-700 rounded text-xs hover:bg-blue-200"
                  title="Copy to Chat Model"
                >
                  â†’ Chat
                </button>
                <button
                  @click="copyModelToAnalysis(model)"
                  class="px-2 py-1 bg-green-100 text-green-700 rounded text-xs hover:bg-green-200"
                  title="Copy to Analysis Model"
                >
                  â†’ Analysis
                </button>
              </div>
            </div>
          </template>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Full Width Sections -->
<div class="space-y-6 mt-6">
  <div class="bg-white rounded-lg p-6 border border-indigo-200">
    <div class="flex items-center justify-between mb-4">
      <div class="flex items-center">
        <div
          class="w-8 h-8 bg-purple-500 rounded-lg flex items-center justify-center mr-3"
        >
          <svg
            class="w-5 h-5 text-white"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"
            />
          </svg>
        </div>
        <h4 class="font-medium text-gray-900">Aspek Analisis Depresi</h4>
        <span
          class="ml-2 bg-purple-100 text-purple-800 text-xs font-medium px-2.5 py-0.5 rounded"
          >Dinamis</span
        >
      </div>
      <button
        @click="addAspect()"
        class="bg-purple-600 text-white px-3 py-1 rounded text-sm hover:bg-purple-700"
      >
        + Tambah Aspek
      </button>
    </div>
    <p class="text-gray-600 mb-6">
      Indikator-indikator gejala depresi yang akan dieksplorasi Anisa dalam
      percakapan
    </p>

    <div class="space-y-3">
      <template
        x-for="(aspect, index) in settings.depression_aspects"
        :key="index"
      >
        <div class="bg-purple-50 p-4 rounded-lg border border-purple-200">
          <div class="flex items-start gap-3">
            <div
              class="flex-shrink-0 w-8 h-8 bg-purple-100 text-purple-600 rounded-full flex items-center justify-center text-sm font-medium"
              x-text="index + 1"
            ></div>
            <div class="flex-1 space-y-2">
              <input
                type="text"
                x-model="aspect.name"
                class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 text-sm font-medium"
                placeholder="Nama aspek (contoh: Anhedonia)"
              />
              <input
                type="text"
                x-model="aspect.description"
                class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 text-sm"
                placeholder="Deskripsi aspek (contoh: kehilangan minat/kenikmatan)"
              />
            </div>
            <button
              @click="removeAspect(index)"
              class="flex-shrink-0 w-8 h-8 bg-red-100 text-red-600 rounded-full flex items-center justify-center hover:bg-red-200"
              x-show="settings.depression_aspects.length > 1"
            >
              <svg
                class="w-4 h-4"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"
                />
              </svg>
            </button>
          </div>
        </div>
      </template>
    </div>
  </div>
</div>

<style>
  .slider::-webkit-slider-thumb {
    appearance: none;
    height: 20px;
    width: 20px;
    border-radius: 50%;
    background: #f97316;
    cursor: pointer;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
  }

  .slider::-moz-range-thumb {
    height: 20px;
    width: 20px;
    border-radius: 50%;
    background: #f97316;
    cursor: pointer;
    border: none;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
  }
</style>
